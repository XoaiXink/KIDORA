@{
    ViewData["Title"] = "Đăng ký";
}
<!-- FIX CHE HEADER -->
<div style="height:140px;"></div>
<div class="container" style="margin-top:140px; margin-bottom:60px;">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow border-0">
                <div class="card-body p-4">

                    <h3 class="text-center mb-4" style="color:var(--kidora-blue); font-weight:700;">
                        Đăng ký tài khoản
                    </h3>

                    @if (ViewBag.Error != null)
                    {
                        <div class="alert alert-danger text-center">
                            @ViewBag.Error
                        </div>
                    }

                    <form method="post">

                        <!-- HỌ TÊN -->
                        <div class="mb-3">
                            <label class="form-label">Họ tên</label>
                            <input type="text" id="hoten" name="hoten" class="form-control p-3" required />
                        </div>

                        <!-- EMAIL -->
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" name="email" class="form-control p-3" required />
                        </div>

                        <!-- SỐ ĐIỆN THOẠI -->
                        <div class="mb-3">
                            <label class="form-label">Số điện thoại</label>
                            <input type="text" id="phone" name="phone" class="form-control p-3" required />
                        </div>

                        <!-- MẬT KHẨU -->
                        <div class="mb-4">
                            <label class="form-label">Mật khẩu</label>
                            <input type="password" name="password" class="form-control p-3" required />
                        </div>

                        <hr />

                        <h5 class="mb-3" style="color:#000; font-weight:700;">Địa chỉ giao hàng</h5>

                        <!-- TỈNH -->
                        <div class="mb-3">
                            <label class="form-label">Tỉnh/Thành phố</label>
                            <select id="tinh" name="tinh" class="form-select p-3" required>
                                <option value="">-- Chọn tỉnh/thành phố --</option>
                            </select>
                        </div>

                        <!-- QUẬN -->
                        <div class="mb-3">
                            <label class="form-label">Quận/Huyện</label>
                            <select id="quan" name="quan" class="form-select p-3" required>
                                <option value="">-- Chọn quận/huyện --</option>
                            </select>
                        </div>

                        <!-- PHƯỜNG/XÃ -->
                        <div class="mb-3">
                            <label class="form-label">Phường / Xã</label>
                            <select id="phuong" name="phuong" class="form-select p-3" required>
                                <option value="">-- Chọn phường/xã --</option>
                            </select>
                        </div>

                        <!-- ĐỊA CHỈ CỤ THỂ -->
                        <div class="mb-3">
                            <label class="form-label">Địa chỉ cụ thể</label>
                            <input type="text" name="diachi" class="form-control p-3"
                                   placeholder="Số nhà, tên đường..." required />
                        </div>


                        <!-- GHI CHÚ -->
                        <div class="mb-4">
                            <label class="form-label">Ghi chú (tuỳ chọn)</label>
                            <input type="text" name="ghichu" class="form-control p-3" />
                        </div>

                        <!-- Hidden để gửi tên nhận & số điện thoại nhận -->
                        <input type="hidden" id="tenNguoiNhan" name="tenNguoiNhan" />
                        <input type="hidden" id="dienThoaiNhan" name="dienThoaiNhan" />

                        <!-- SUBMIT -->
                        <button type="submit" class="btn w-100 p-3"
                                style="background:var(--kidora-blue); border:none; font-weight:600; color:white;">
                            Đăng ký
                        </button>

                        <p class="text-center mt-3">
                            Đã có tài khoản?
                            <a asp-controller="Account" asp-action="Login" style="color:var(--kidora-blue); font-weight:600;">
                                Đăng nhập
                            </a>
                        </p>

                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Gán tự động tên người nhận & số điện thoại
        document.getElementById("hoten").addEventListener("input", function () {
            document.getElementById("tenNguoiNhan").value = this.value;
        });

        document.getElementById("phone").addEventListener("input", function () {
            document.getElementById("dienThoaiNhan").value = this.value;
        });

                // ============= LOAD DANH SÁCH TỈNH =============
        fetch("https://provinces.open-api.vn/api/p/")
            .then(res => res.json())
            .then(data => {
                let tinhSelect = document.getElementById("tinh");
                data.forEach(t => {
                    let opt = document.createElement("option");
                    opt.value = t.name;
                    opt.textContent = t.name;
                    opt.setAttribute("data-code", t.code);
                    tinhSelect.appendChild(opt);
                });
            });

        // ============= LOAD QUẬN ========================
        document.getElementById("tinh").addEventListener("change", function () {

            let code = this.options[this.selectedIndex].getAttribute("data-code");

            let quanSelect = document.getElementById("quan");
            let phuongSelect = document.getElementById("phuong");

            quanSelect.innerHTML = `<option value="">-- Chọn quận/huyện --</option>`;
            phuongSelect.innerHTML = `<option value="">-- Chọn phường/xã --</option>`;

            fetch(`https://provinces.open-api.vn/api/p/${code}?depth=2`)
                .then(res => res.json())
                .then(data => {

                    data.districts.forEach(q => {
                        let opt = document.createElement("option");
                        opt.value = q.name;
                        opt.textContent = q.name;
                        opt.setAttribute("data-code", q.code);
                        quanSelect.appendChild(opt);
                    });

                });
        });

        // ============= LOAD PHƯỜNG/XÃ =====================
        document.getElementById("quan").addEventListener("change", function () {

            let code = this.options[this.selectedIndex].getAttribute("data-code");
            let phuongSelect = document.getElementById("phuong");

            phuongSelect.innerHTML = `<option value="">-- Chọn phường/xã --</option>`;

            fetch(`https://provinces.open-api.vn/api/d/${code}?depth=2`)
                .then(res => res.json())
                .then(data => {

                    data.wards.forEach(w => {
                        let opt = document.createElement("option");
                        opt.value = w.name;
                        opt.textContent = w.name;
                        phuongSelect.appendChild(opt);
                    });

                });
        });
    </script>
}
